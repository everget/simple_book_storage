(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(o){if(o.ep)return;o.ep=!0;const l=a(o);fetch(o.href,l)}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(e){if(e.ep)return;e.ep=!0;const o=n(e);fetch(e.href,o)}})();const i={prefix:"bookapp-",has(t){return!!localStorage.getItem(i.prefix+String(t))},generateHash(t){const n=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZ",..."abcdefghijklmnopqrstuvwxyz",..."0123456789",...t];return[...Array(16)].map(a=>n[Math.random()*n.length|0]).join("")},create({author:t,name:n,year:a,pages:e}){return{id:i.generateHash(n),author:i.escapeString(t),name:i.escapeString(n),year:i.escapeString(a),pages:i.escapeString(e)}},getItem(t){return i.parseJSON(localStorage.getItem(i.prefix+String(t)))},getAllItems(){const t=[];let n=localStorage.length;for(;n--;){const a=localStorage.key(n);a.startsWith(i.prefix)&&t.push(i.parseJSON(localStorage.getItem(a)))}return t},saveItem(t,n){const a=i.prefix+t.id;try{localStorage.setItem(a,i.toJSON(t)),typeof n=="function"&&n()}catch(e){const o=/quota/i;(e.toString().indexOf("QuotaExceededError")!==-1||e.toString().indexOf("QUOTA_EXCEEDED_ERR")!==-1||o.test(e.name)||o.test(e.message))&&alert("The localStorage is full")}},removeItem(t,n){localStorage.removeItem(i.prefix+t),typeof n=="function"&&n()},size(){return localStorage.length},clear(){localStorage.clear()},toJSON(t){return JSON.stringify(t)},parseJSON(t){try{return JSON.parse(t)}catch{return String(t)}},escapeString(t){const n=t==null?"":`${t}`,a={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&quot;",'"':"&#x27;","`":"&#x60;"};return n.replace(/[<>&"'`]/g,e=>a[e])}},d={DEFAULT:"default",EDITING:"editing"},r={$body:null,$form:null,$inputs:null,$author:null,$name:null,$year:null,$pages:null,$table:null,$addButton:null,$showMoreButton:null,MODES:d,state:{mode:d.DEFAULT,editedItemId:null},props:{},init({onInputCallback:t,onAddItemCallback:n,onRemoveItemCallback:a,onEditItemCallback:e,onShowMoreCallback:o}){r.$body=$("html, body"),r.$inputs=$('[data-js-selector^="form-input-"]'),r.$author=$('[data-js-selector="form-input-author"]'),r.$name=$('[data-js-selector="form-input-name"]'),r.$year=$('[data-js-selector="form-input-year"]'),r.$pages=$('[data-js-selector="form-input-pages"]'),r.$table=$('[data-js-selector="table-body"]'),r.$addButton=$('[data-js-selector="add-button"]'),r.$showMoreButton=$('[data-js-selector="show-more-button"]'),r.$year.mask("9?999",{placeholder:"_",completed:function(){this.trigger("input")}}),r.$pages.mask("9?99",{placeholder:"_",completed:function(){this.trigger("input")}}),Object.assign(r.props,{onInputCallback:t,onAddItemCallback:n,onRemoveItemCallback:a,onEditItemCallback:e,onShowMoreCallback:o}),r.$inputs.on("input",r.onInputHandler),r.$addButton.on("click",r.onAddItemHandler),r.$table.on("click",'[data-js-selector="edit-button"]',r.onEditItemHandler),r.$table.on("click",'[data-js-selector="remove-button"]',r.onRemoveItemHandler),r.$showMoreButton.on("click",r.onShowMoreHandler)},isEditingState(){return r.state.mode===r.MODES.EDITING},setState(t){Object.assign(r.state,t),t.mode===r.MODES.EDITING?r.$addButton.text("Save changes").removeAttr("disabled"):(r.$addButton.text("Add new book").attr("disabled","disabled"),r.clearInputs())},onInputHandler(t){r.hasEmptyInputs()||r.$addButton.removeAttr("disabled"),r.props.onInputCallback==="function"&&r.props.onInputCallback()},onAddItemHandler(t){r.hasEmptyInputs()||typeof r.props.onAddItemCallback=="function"&&r.props.onAddItemCallback({id:r.state.editedItemId,...r.getInputValues()})},onRemoveItemHandler(t){if(typeof r.props.onRemoveItemCallback=="function"){const n=$(t.target).closest('[data-js-selector="item-row"]').data("js-item-id");r.props.onRemoveItemCallback(n)}},onEditItemHandler(t){const n=$(t.target).closest('[data-js-selector="item-row"]').data("js-item-id");typeof r.props.onEditItemCallback=="function"&&r.props.onEditItemCallback(n)},onShowMoreHandler(t){typeof r.props.onShowMoreCallback=="function"&&r.props.onShowMoreCallback()},fillInputs({author:t="",name:n="",year:a="",pages:e=""}={}){r.$author.val(t),r.$name.val(n),r.$year.val(a),r.$pages.val(e)},clearInputs(){r.fillInputs()},getInputValues(){return{author:r.$author.val(),name:r.$name.val(),year:r.$year.val(),pages:r.$pages.val()}},hasEmptyInputs(){return!r.$author.val()||!r.$name.val()||!r.$year.val()||!r.$pages.val()},compileRowTemplate:({id:t,author:n,name:a})=>`
		<tr class="table-row" data-js-selector="item-row" data-js-item-id="${t}">
			<td data-js-item-author="${n}"><div>${n}</div></td>
			<td data-js-item-name="${a}"><div>${a}</div></td>
			<td>
				<button type="button" data-js-selector="edit-button" class="btn btn-primary edit-button">
					<span class="hidden-xs">Edit</span>
					<span class="glyphicon glyphicon-pencil visible-xs"></span>
				</button>
				<button type="button" data-js-selector="remove-button" class="btn btn-danger remove-button">
					<span class="hidden-xs">Remove</span>
					<span class="glyphicon glyphicon-trash visible-xs"></span>
				</button>
			</td>
		</tr>
	`,updateItem(t){r.$table.find(`[data-js-item-id="${t.id}"]`).children().filter("[data-js-item-author]").data("js-item-author",t.author).text(t.author).end().filter("[data-js-item-name]").data("js-item-name",t.name).text(t.name)},renderItem(t){r.$table.append(r.compileRowTemplate(t)).children().last().fadeIn("fast")},renderItems(t){if(t.length===0)return;let n=0;const a=setInterval(()=>{n<t.length?(r.$table.append(r.compileRowTemplate(t[n])).children("tr").eq(n).fadeIn("fast"),r.scrollToBottom(),n++):(clearInterval(a),n=0)},300)},removeItem(t){const n=r.$table.find(`[data-js-item-id=${t}]`);n.css({height:n.height()}).animate({opacity:0},300).children().hide().end().animate({height:"0px"},200),setTimeout(()=>{n.remove()},600)},scrollTo(t,n){r.$body.animate({scrollTop:t},n)},scrollToBottom(){scrollTo($(document).height()-$(window).height(),300)},scrollToTop(){scrollTo(0,600)}},s={init(){s.isLocalStorageSupported()||alert("Sorry, localStorage is not supported by your browser!"),r.init({onAddItemCallback:s.onAddItemCallback,onRemoveItemCallback:s.onRemoveItemCallback,onEditItemCallback:s.onEditItemCallback,onShowMoreCallback:s.onShowMoreCallback}),r.renderItems(i.getAllItems())},onAddItemCallback(...t){s.addItem(...t)},onRemoveItemCallback(...t){s.removeItem(...t)},onEditItemCallback(...t){s.editItem(...t)},onShowMoreCallback(...t){s.showMore(...t)},addItem(t){if(r.isEditingState())i.saveItem(t),r.updateItem(t);else{const n=i.create(t);i.saveItem(n),r.renderItem(n)}r.setState({mode:r.MODES.DEFAULT,editedItemId:null})},editItem(t){r.setState({mode:r.MODES.EDITING,editedItemId:t}),r.scrollToTop(),r.fillInputs(i.getItem(t))},removeItem(t){i.removeItem(t,()=>{r.removeItem(t),r.setState({mode:r.MODES.DEFAULT,editedItemId:null})})},showMore(){alert("Show More!")},isLocalStorageSupported(){const t="modernizr";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}};$(document).ready(()=>{s.init()});
