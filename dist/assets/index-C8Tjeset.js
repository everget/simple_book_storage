(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const n={prefix:"bookapp-",has(t){return!!localStorage.getItem(n.prefix+String(t))},generateHash(t){const a=[..."ABCDEFGHIJKLMNOPQRSTUVWXYZ",..."abcdefghijklmnopqrstuvwxyz",..."0123456789",...t];return[...Array(16)].map(r=>a[Math.random()*a.length|0]).join("")},create({author:t,name:a,year:r,pages:l}){return{id:n.generateHash(a),author:n.escapeString(t),name:n.escapeString(a),year:n.escapeString(r),pages:n.escapeString(l)}},getItem(t){return n.parseJSON(localStorage.getItem(n.prefix+String(t)))},getAllItems(){const t=[];let a=localStorage.length;for(;a--;){const r=localStorage.key(a);r.startsWith(n.prefix)&&t.push(n.parseJSON(localStorage.getItem(r)))}return t},saveItem(t,a){const r=n.prefix+t.id;try{localStorage.setItem(r,n.toJSON(t)),typeof a=="function"&&a()}catch(l){const o=/quota/i;(l.toString().indexOf("QuotaExceededError")!==-1||l.toString().indexOf("QUOTA_EXCEEDED_ERR")!==-1||o.test(l.name)||o.test(l.message))&&alert("The localStorage is full")}},removeItem(t,a){localStorage.removeItem(n.prefix+t),typeof a=="function"&&a()},size(){return localStorage.length},clear(){localStorage.clear()},toJSON(t){return JSON.stringify(t)},parseJSON(t){try{return JSON.parse(t)}catch{return String(t)}},escapeString(t){const a=t==null?"":`${t}`,r={"<":"&lt;",">":"&gt;","&":"&amp;","'":"&quot;",'"':"&#x27;","`":"&#x60;"};return a.replace(/[<>&"'`]/g,l=>r[l])}},c={DEFAULT:"default",EDITING:"editing"},e={$body:null,$form:null,$inputs:null,$author:null,$name:null,$year:null,$pages:null,$table:null,$addButton:null,MODES:c,state:{mode:c.DEFAULT,editedItemId:null},props:{},init({onInputCallback:t,onAddItemCallback:a,onRemoveItemCallback:r,onEditItemCallback:l}){e.$body=$("html, body"),e.$inputs=$('[data-js-selector^="form-input-"]'),e.$author=$('[data-js-selector="form-input-author"]'),e.$name=$('[data-js-selector="form-input-name"]'),e.$year=$('[data-js-selector="form-input-year"]'),e.$pages=$('[data-js-selector="form-input-pages"]'),e.$table=$('[data-js-selector="table-body"]'),e.$addButton=$('[data-js-selector="add-button"]'),e.$year.mask("9?999",{placeholder:"_",completed:function(){this.trigger("input")}}),e.$pages.mask("9?99",{placeholder:"_",completed:function(){this.trigger("input")}}),Object.assign(e.props,{onInputCallback:t,onAddItemCallback:a,onRemoveItemCallback:r,onEditItemCallback:l}),e.$inputs.on("input",e.onInputHandler),e.$addButton.on("click",e.onAddItemHandler),e.$table.on("click",'[data-js-selector="edit-button"]',e.onEditItemHandler),e.$table.on("click",'[data-js-selector="remove-button"]',e.onRemoveItemHandler)},isEditingState(){return e.state.mode===e.MODES.EDITING},setState(t){Object.assign(e.state,t),t.mode===e.MODES.EDITING?e.$addButton.text("Save changes").removeAttr("disabled"):(e.$addButton.text("Add new book").attr("disabled","disabled"),e.clearInputs())},onInputHandler(){e.hasEmptyInputs()||e.$addButton.removeAttr("disabled"),e.props.onInputCallback==="function"&&e.props.onInputCallback()},onAddItemHandler(){e.hasEmptyInputs()||typeof e.props.onAddItemCallback=="function"&&e.props.onAddItemCallback({id:e.state.editedItemId,...e.getInputValues()})},onRemoveItemHandler(t){if(typeof e.props.onRemoveItemCallback=="function"){const a=$(t.target).closest('[data-js-selector="item-row"]').data("js-item-id");e.props.onRemoveItemCallback(a)}},onEditItemHandler(t){const a=$(t.target).closest('[data-js-selector="item-row"]').data("js-item-id");typeof e.props.onEditItemCallback=="function"&&e.props.onEditItemCallback(a)},fillInputs({author:t="",name:a="",year:r="",pages:l=""}={}){e.$author.val(t),e.$name.val(a),e.$year.val(r),e.$pages.val(l)},clearInputs(){e.fillInputs()},getInputValues(){return{author:e.$author.val(),name:e.$name.val(),year:e.$year.val(),pages:e.$pages.val()}},hasEmptyInputs(){return!e.$author.val()||!e.$name.val()||!e.$year.val()||!e.$pages.val()},compileRowTemplate:({id:t,author:a,name:r})=>`
		<tr class="table-row" data-js-selector="item-row" data-js-item-id="${t}">
			<td data-js-item-author="${a}"><div>${a}</div></td>
			<td data-js-item-name="${r}"><div>${r}</div></td>
			<td>
				<button type="button" data-js-selector="edit-button" class="btn btn-primary edit-button">
					<span class="hidden-xs">Edit</span>
					<span class="glyphicon glyphicon-pencil visible-xs"></span>
				</button>
				<button type="button" data-js-selector="remove-button" class="btn btn-danger remove-button">
					<span class="hidden-xs">Remove</span>
					<span class="glyphicon glyphicon-trash visible-xs"></span>
				</button>
			</td>
		</tr>
	`,updateItem(t){e.$table.find(`[data-js-item-id="${t.id}"]`).children().filter("[data-js-item-author]").data("js-item-author",t.author).text(t.author).end().filter("[data-js-item-name]").data("js-item-name",t.name).text(t.name)},renderItem(t){e.$table.append(e.compileRowTemplate(t)).children().last().fadeIn("fast")},renderItems(t){if(t.length===0)return;let a=0;const r=setInterval(()=>{a<t.length?(e.$table.append(e.compileRowTemplate(t[a])).children("tr").eq(a).fadeIn("fast"),e.scrollToBottom(),a++):(clearInterval(r),a=0)},300)},removeItem(t){const a=e.$table.find(`[data-js-item-id=${t}]`);a.css({height:a.height()}).animate({opacity:0},300).children().hide().end().animate({height:"0px"},200),setTimeout(()=>{a.remove()},600)},scrollTo(t,a){e.$body.animate({scrollTop:t},a)},scrollToBottom(){scrollTo($(document).height()-$(window).height(),300)},scrollToTop(){scrollTo(0,600)}},i={init(){i.isLocalStorageSupported()||alert("Sorry, localStorage is not supported by your browser!"),e.init({onAddItemCallback:i.onAddItemCallback,onRemoveItemCallback:i.onRemoveItemCallback,onEditItemCallback:i.onEditItemCallback}),e.renderItems(n.getAllItems())},onAddItemCallback(...t){i.addItem(...t)},onRemoveItemCallback(...t){i.removeItem(...t)},onEditItemCallback(...t){i.editItem(...t)},addItem(t){if(e.isEditingState())n.saveItem(t),e.updateItem(t);else{const a=n.create(t);n.saveItem(a),e.renderItem(a)}e.setState({mode:e.MODES.DEFAULT,editedItemId:null})},editItem(t){e.setState({mode:e.MODES.EDITING,editedItemId:t}),e.scrollToTop(),e.fillInputs(n.getItem(t))},removeItem(t){n.removeItem(t,()=>{e.removeItem(t),e.setState({mode:e.MODES.DEFAULT,editedItemId:null})})},isLocalStorageSupported(){const t="modernizr";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch{return!1}}};$(document).ready(()=>{i.init()});
